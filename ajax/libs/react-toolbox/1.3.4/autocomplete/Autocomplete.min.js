"use strict";function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _objectWithoutProperties(e,t){var r={};for(var o in e)t.indexOf(o)>=0||Object.prototype.hasOwnProperty.call(e,o)&&(r[o]=e[o]);return r}function _defineProperty(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function _toConsumableArray(e){if(Array.isArray(e)){for(var t=0,r=Array(e.length);t<e.length;t++)r[t]=e[t];return r}return Array.from(e)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(exports,"__esModule",{value:!0}),exports.Autocomplete=exports.autocompleteFactory=void 0;var _extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var o in r)Object.prototype.hasOwnProperty.call(r,o)&&(e[o]=r[o])}return e},_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_slicedToArray=function(){function e(e,t){var r=[],o=!0,n=!1,s=void 0;try{for(var a,u=e[Symbol.iterator]();!(o=(a=u.next()).done)&&(r.push(a.value),!t||r.length!==t);o=!0);}catch(e){n=!0,s=e}finally{try{!o&&u.return&&u.return()}finally{if(n)throw s}}return r}return function(t,r){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,r);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),_createClass=function(){function e(e,t){for(var r=0;r<t.length;r++){var o=t[r];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,r,o){return r&&e(t.prototype,r),o&&e(t,o),t}}(),_react=require("react"),_react2=_interopRequireDefault(_react),_reactDom=require("react-dom"),_reactDom2=_interopRequireDefault(_reactDom),_classnames4=require("classnames"),_classnames5=_interopRequireDefault(_classnames4),_reactCssThemr=require("react-css-themr"),_identifiers=require("../identifiers.js"),_Chip=require("../chip/Chip.js"),_Chip2=_interopRequireDefault(_Chip),_Input=require("../input/Input.js"),_Input2=_interopRequireDefault(_Input),_events=require("../utils/events.js"),_events2=_interopRequireDefault(_events),POSITION={AUTO:"auto",DOWN:"down",UP:"up"},factory=function(e,t){var r=function(r){function o(){var e,t,r,n;_classCallCheck(this,o);for(var s=arguments.length,a=Array(s),u=0;u<s;u++)a[u]=arguments[u];return t=r=_possibleConstructorReturn(this,(e=o.__proto__||Object.getPrototypeOf(o)).call.apply(e,[this].concat(a))),r.state={direction:r.props.direction,focus:!1,showAllSuggestions:r.props.showSuggestionsWhenValueIsSet,query:r.query(r.props.value),isValueAnObject:!1},r.handleChange=function(e,t){var o=r.props.multiple?e:e[0],n=r.props.showSuggestionsWhenValueIsSet,s=r.query(o);r.props.onChange&&r.props.onChange(o,t),r.props.keepFocusOnChange?r.setState({query:s,showAllSuggestions:n}):r.setState({focus:!1,query:s,showAllSuggestions:n},function(){_reactDom2.default.findDOMNode(r).querySelector("input").blur()})},r.handleMouseDown=function(e){r.selectOrCreateActiveItem(e)},r.handleQueryBlur=function(e){r.state.focus&&r.setState({focus:!1}),r.props.onBlur&&r.props.onBlur(e,r.state.active)},r.handleQueryChange=function(e){r.props.onQueryChange&&r.props.onQueryChange(e),r.setState({query:e,showAllSuggestions:!1,active:null})},r.handleQueryFocus=function(e){r.suggestionsNode.scrollTop=0,r.setState({active:"",focus:!0}),r.props.onFocus&&r.props.onFocus(e)},r.handleQueryKeyDown=function(e){var t=8===e.which&&r.props.showSuggestionsWhenValueIsSet&&r.state.showAllSuggestions;t&&r.setState({query:""}),13===e.which&&r.selectOrCreateActiveItem(e)},r.handleQueryKeyUp=function(e){if(27===e.which&&_reactDom2.default.findDOMNode(r).querySelector("input").blur(),[40,38].indexOf(e.which)!==-1){var t=[].concat(_toConsumableArray(r.suggestions().keys())),o=t.indexOf(r.state.active)+(40===e.which?1:-1);o<0&&(o=t.length-1),o>=t.length&&(o=0),r.setState({active:t[o]})}},r.handleSuggestionHover=function(e){r.setState({active:e.target.id})},r.select=function(e,t){_events2.default.pauseEvent(e);var o=r.values(r.props.value),n=r.source(),s=void 0===t?e.target.id:t;if(r.isValueAnObject()){var a=Array.from(n).reduce(function(e,t){var r=_slicedToArray(t,2),o=r[0],n=r[1];return o===s&&(e[o]=n),e},{});return r.handleChange(Object.assign(r.mapToObject(o),a),e)}r.handleChange([s].concat(_toConsumableArray(o.keys())),e)},n=t,_possibleConstructorReturn(r,n)}return _inherits(o,r),_createClass(o,[{key:"componentWillReceiveProps",value:function(e){this.props.multiple||this.setState({query:this.query(e.value)})}},{key:"shouldComponentUpdate",value:function(e,t){if(!this.state.focus&&t.focus&&this.props.direction===POSITION.AUTO){var r=this.calculateDirection();this.state.direction!==r&&this.setState({direction:r})}return!0}},{key:"calculateDirection",value:function(){if("auto"===this.props.direction){var e=_reactDom2.default.findDOMNode(this.inputNode).getBoundingClientRect(),t=window.innerHeight||document.documentElement.offsetHeight,r=e.top>t/2+e.height;return r?"up":"down"}return this.props.direction}},{key:"query",value:function(e){var t="";if(!this.props.multiple&&e){var r=this.source().get(""+e);t=r?r:e}return t}},{key:"selectOrCreateActiveItem",value:function(e){var t=this.state.active;t||(t=this.props.allowCreate?this.state.query:[].concat(_toConsumableArray(this.suggestions().keys()))[0],this.setState({active:t})),this.select(e,t)}},{key:"suggestions",value:function(){var e=new Map,t=this.state.query||(this.props.multiple?"":this.props.value),r=(""+t).toLowerCase().trim(),o=this.values(),n=this.source();if(this.props.multiple){var s=!0,a=!1,u=void 0;try{for(var i,c=n[Symbol.iterator]();!(s=(i=c.next()).done);s=!0){var l=_slicedToArray(i.value,2),p=l[0],h=l[1];!o.has(p)&&this.matches(h.toLowerCase().trim(),r)&&e.set(p,h)}}catch(e){a=!0,u=e}finally{try{!s&&c.return&&c.return()}finally{if(a)throw u}}}else if(r&&!this.state.showAllSuggestions){var f=!0,y=!1,d=void 0;try{for(var v,_=n[Symbol.iterator]();!(f=(v=_.next()).done);f=!0){var g=_slicedToArray(v.value,2),p=g[0],h=g[1];this.matches(h.toLowerCase().trim(),r)&&e.set(p,h)}}catch(e){y=!0,d=e}finally{try{!f&&_.return&&_.return()}finally{if(y)throw d}}}else e=n;return e}},{key:"matches",value:function(e,t){var r=this.props.suggestionMatch;if("start"===r)return e.startsWith(t);if("anywhere"===r)return e.includes(t);if("word"===r){var o=new RegExp("\\b"+t,"g");return o.test(e)}return!1}},{key:"source",value:function(){var e=this.props.source;return e.hasOwnProperty("length")?new Map(e.map(function(e){return Array.isArray(e)?[].concat(_toConsumableArray(e)):[e,e]})):new Map(Object.keys(e).map(function(t){return[""+t,e[t]]}))}},{key:"values",value:function(){var e=this.props.multiple?this.props.value:[this.props.value];if(e||(e=[]),this.props.showSelectedWhenNotInSource&&this.isValueAnObject())return new Map(Object.entries(e));var t=new Map,r=e.map(function(e){return""+e}),o=!0,n=!1,s=void 0;try{for(var a,u=this.source()[Symbol.iterator]();!(o=(a=u.next()).done);o=!0){var i=_slicedToArray(a.value,2),c=i[0],l=i[1];r.indexOf(c)!==-1&&t.set(c,l)}}catch(e){n=!0,s=e}finally{try{!o&&u.return&&u.return()}finally{if(n)throw s}}return t}},{key:"unselect",value:function(e,t){if(!this.props.disabled){var r=this.values(this.props.value);if(r.delete(e),this.isValueAnObject())return this.handleChange(this.mapToObject(r),t);this.handleChange([].concat(_toConsumableArray(r.keys())),t)}}},{key:"isValueAnObject",value:function(){return!Array.isArray(this.props.value)&&"object"===_typeof(this.props.value)}},{key:"mapToObject",value:function(e){return Array.from(e).reduce(function(e,t){var r=_slicedToArray(t,2),o=r[0],n=r[1];return e[o]=n,e},{})}},{key:"renderSelected",value:function(){var t=this;if(this.props.multiple){var r=[].concat(_toConsumableArray(this.values())).map(function(r){var o=_slicedToArray(r,2),n=o[0],s=o[1];return _react2.default.createElement(e,{key:n,className:t.props.theme.value,deletable:!0,onDeleteClick:t.unselect.bind(t,n)},s)});return _react2.default.createElement("ul",{className:this.props.theme.values},r)}}},{key:"renderSuggestions",value:function(){var e=this,t=this.props.theme,r=[].concat(_toConsumableArray(this.suggestions())).map(function(r){var o=_slicedToArray(r,2),n=o[0],s=o[1],a=(0,_classnames5.default)(t.suggestion,_defineProperty({},t.active,e.state.active===n));return _react2.default.createElement("li",{id:n,key:n,className:a,onMouseDown:e.handleMouseDown,onMouseOver:e.handleSuggestionHover},s)});return _react2.default.createElement("ul",{className:(0,_classnames5.default)(t.suggestions,_defineProperty({},t.up,"up"===this.state.direction)),ref:function(t){e.suggestionsNode=t}},r)}},{key:"render",value:function(){var e=this,r=this.props,o=(r.allowCreate,r.error),n=r.label,s=(r.source,r.suggestionMatch,r.selectedPosition,r.keepFocusOnChange,r.showSuggestionsWhenValueIsSet,r.showSelectedWhenNotInSource,r.onQueryChange,r.theme),a=_objectWithoutProperties(r,["allowCreate","error","label","source","suggestionMatch","selectedPosition","keepFocusOnChange","showSuggestionsWhenValueIsSet","showSelectedWhenNotInSource","onQueryChange","theme"]),u=(0,_classnames5.default)(s.autocomplete,_defineProperty({},s.focus,this.state.focus),this.props.className);return _react2.default.createElement("div",{"data-react-toolbox":"autocomplete",className:u},"above"===this.props.selectedPosition?this.renderSelected():null,_react2.default.createElement(t,_extends({},a,{ref:function(t){e.inputNode=t},autoComplete:"off",className:s.input,error:o,label:n,onBlur:this.handleQueryBlur,onChange:this.handleQueryChange,onFocus:this.handleQueryFocus,onKeyDown:this.handleQueryKeyDown,onKeyUp:this.handleQueryKeyUp,theme:s,themeNamespace:"input",value:this.state.query})),this.renderSuggestions(),"below"===this.props.selectedPosition?this.renderSelected():null)}}]),o}(_react.Component);return r.propTypes={allowCreate:_react.PropTypes.bool,className:_react.PropTypes.string,direction:_react.PropTypes.oneOf(["auto","up","down"]),disabled:_react.PropTypes.bool,error:_react2.default.PropTypes.oneOfType([_react2.default.PropTypes.string,_react2.default.PropTypes.node]),keepFocusOnChange:_react.PropTypes.bool,label:_react2.default.PropTypes.oneOfType([_react2.default.PropTypes.string,_react2.default.PropTypes.node]),multiple:_react.PropTypes.bool,onBlur:_react.PropTypes.func,onChange:_react.PropTypes.func,onFocus:_react.PropTypes.func,onQueryChange:_react.PropTypes.func,selectedPosition:_react.PropTypes.oneOf(["above","below","none"]),showSelectedWhenNotInSource:_react.PropTypes.bool,showSuggestionsWhenValueIsSet:_react.PropTypes.bool,source:_react.PropTypes.any,suggestionMatch:_react.PropTypes.oneOf(["start","anywhere","word"]),theme:_react.PropTypes.shape({active:_react.PropTypes.string,autocomplete:_react.PropTypes.string,focus:_react.PropTypes.string,input:_react.PropTypes.string,suggestion:_react.PropTypes.string,suggestions:_react.PropTypes.string,up:_react.PropTypes.string,value:_react.PropTypes.string,values:_react.PropTypes.string}),value:_react.PropTypes.any},r.defaultProps={allowCreate:!1,className:"",direction:"auto",keepFocusOnChange:!1,multiple:!0,selectedPosition:"above",showSelectedWhenNotInSource:!1,showSuggestionsWhenValueIsSet:!1,source:{},suggestionMatch:"start"},r},Autocomplete=factory(_Chip2.default,_Input2.default);exports.default=(0,_reactCssThemr.themr)(_identifiers.AUTOCOMPLETE)(Autocomplete),exports.autocompleteFactory=factory,exports.Autocomplete=Autocomplete;
//# sourceMappingURL=Autocomplete.min.js.map