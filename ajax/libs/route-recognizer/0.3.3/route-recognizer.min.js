!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define("route-recognizer",e):t.RouteRecognizer=e()}(this,function(){"use strict";function t(){var t=v(null);return t.__=void 0,delete t.__,t}function e(t,r,n){function o(o,a){var i=t+o;if(!a)return new g(i,r,n);a(e(i,r,n))}return o}function r(t,e,r){for(var n=0,o=0;o<t.length;o++)n+=t[o].path.length;var a={path:e=e.substr(n),handler:r};t.push(a)}function n(t,e,o,a){for(var i=e.routes,s=Object.keys(i),h=0;h<s.length;h++){var u=s[h],c=t.slice();r(c,u,i[u]);var p=e.children[u];p?n(c,p,o,a):o.call(a,c)}}function o(t){return t.split("/").map(a).join("/")}function a(t){return t.length<3||-1===t.indexOf("%")?t:decodeURIComponent(t).replace(E,encodeURIComponent)}function i(t){return encodeURIComponent(t).replace(S,decodeURIComponent)}function s(t,e){if("object"!=typeof t||null===t)throw new Error("You must pass an object as the second argument to `generate`.");if(!C.call(t,e))throw new Error("You must provide param `"+e+"` to `generate`.");var r=t[e],n="string"==typeof r?r:""+r;if(0===n.length)throw new Error("You must provide a param `"+e+"`.");return n}function h(t,e,r){e.length>0&&47===e.charCodeAt(0)&&(e=e.substr(1));for(var n=e.split("/"),o=void 0,i=void 0,s=0;s<n.length;s++){var h=n[s],u=0,c=0;12&(u=2<<(c=""===h?4:58===h.charCodeAt(0)?1:42===h.charCodeAt(0)?2:0))&&(h=h.slice(1),(o=o||[]).push(h),(i=i||[]).push(0!=(4&u))),14&u&&r[c]++,t.push({type:c,value:a(h)})}return{names:o||R,shouldDecodes:i||R}}function u(t,e,r){return t.char===e&&t.negate===r}function c(t,e){return t.negate?t.char!==e&&-1!==t.char:t.char===e||-1===t.char}function p(t){return t.sort(function(t,e){var r=t.types||[0,0,0],n=r[0],o=r[1],a=r[2],i=e.types||[0,0,0],s=i[0],h=i[1],u=i[2];if(a!==u)return a-u;if(a){if(n!==s)return s-n;if(o!==h)return h-o}return o!==h?o-h:n!==s?s-n:0})}function l(t,e){for(var r=[],n=0,o=t.length;n<o;n++){var a=t[n];r=r.concat(a.match(e))}return r}function f(t,e,r){var n=t.handlers,o=t.regex();if(!o||!n)throw new Error("state not initialized");var a=e.match(o),i=1,s=new N(r);s.length=n.length;for(var h=0;h<n.length;h++){var u=n[h],c=u.names,p=u.shouldDecodes,l=O,f=!1;if(c!==R&&p!==R)for(var d=0;d<c.length;d++){f=!0;var v=c[d],g=a&&a[i++];l===O&&(l={}),j.ENCODE_AND_DECODE_PATH_SEGMENTS&&p[d]?l[v]=g&&decodeURIComponent(g):l[v]=g}s[h]={handler:u.handler,params:l,isDynamic:f}}return s}function d(t){t=t.replace(/\+/gm,"%20");var e;try{e=decodeURIComponent(t)}catch(t){e=""}return e}var v=Object.create,g=function(t,e,r){this.path=t,this.matcher=e,this.delegate=r};g.prototype.to=function(t,e){var r=this.delegate;if(r&&r.willAddRoute&&(t=r.willAddRoute(this.matcher.target,t)),this.matcher.add(this.path,t),e){if(0===e.length)throw new Error("You must have an argument in the function passed to `to`");this.matcher.addChild(this.path,t,e,this.delegate)}};var y=function(e){this.routes=t(),this.children=t(),this.target=e};y.prototype.add=function(t,e){this.routes[t]=e},y.prototype.addChild=function(t,r,n,o){var a=new y(r);this.children[t]=a;var i=e(t,a,o);o&&o.contextEntered&&o.contextEntered(r,i),n(i)};var m=function(t,r){var o=new y;t(e("",o,this.delegate)),n([],o,function(t){r?r(this,t):this.add(t)},this)},E=/%|\//g,S=/%(?:2(?:4|6|B|C)|3(?:B|D|A)|40)/g,w=/(\/|\.|\*|\+|\?|\||\(|\)|\[|\]|\{|\}|\\)/g,A=Array.isArray,C=Object.prototype.hasOwnProperty,_=[];_[0]=function(t,e){for(var r=e,n=t.value,o=0;o<n.length;o++){var a=n.charCodeAt(o);r=r.put(a,!1,!1)}return r},_[1]=function(t,e){return e.put(47,!0,!0)},_[2]=function(t,e){return e.put(-1,!1,!0)},_[4]=function(t,e){return e};var x=[];x[0]=function(t){return t.value.replace(w,"\\$1")},x[1]=function(){return"([^/]+)"},x[2]=function(){return"(.+)"},x[4]=function(){return""};var D=[];D[0]=function(t){return t.value},D[1]=function(t,e){var r=s(e,t.value);return j.ENCODE_AND_DECODE_PATH_SEGMENTS?i(r):r},D[2]=function(t,e){return s(e,t.value)},D[4]=function(){return""};var O=Object.freeze({}),R=Object.freeze([]),b=function(t,e,r,n,o){this.states=t,this.id=e,this.char=r,this.negate=n,this.nextStates=o?e:null,this.pattern="",this._regex=void 0,this.handlers=void 0,this.types=void 0};b.prototype.regex=function(){return this._regex||(this._regex=new RegExp(this.pattern)),this._regex},b.prototype.get=function(t,e){var r=this,n=this.nextStates;if(null!==n)if(A(n))for(var o=0;o<n.length;o++){var a=r.states[n[o]];if(u(a,t,e))return a}else{var i=this.states[n];if(u(i,t,e))return i}},b.prototype.put=function(t,e,r){var n;if(n=this.get(t,e))return n;var o=this.states;return n=new b(o,o.length,t,e,r),o[o.length]=n,null==this.nextStates?this.nextStates=n.id:A(this.nextStates)?this.nextStates.push(n.id):this.nextStates=[this.nextStates,n.id],n},b.prototype.match=function(t){var e=this,r=this.nextStates;if(!r)return[];var n=[];if(A(r))for(var o=0;o<r.length;o++){var a=e.states[r[o]];c(a,t)&&n.push(a)}else{var i=this.states[r];c(i,t)&&n.push(i)}return n};var N=function(t){this.length=0,this.queryParams=t||{}};N.prototype.splice=Array.prototype.splice,N.prototype.slice=Array.prototype.slice,N.prototype.push=Array.prototype.push;var j=function(){this.names=t();var e=[],r=new b(e,0,-1,!0,!1);e[0]=r,this.states=e,this.rootState=r};return j.prototype.add=function(t,e){for(var r=this.rootState,n="^",o=[0,0,0],a=new Array(t.length),i=[],s=!0,u=0,c=0;c<t.length;c++){for(var p=t[c],l=h(i,p.path,o),f=l.names,d=l.shouldDecodes;u<i.length;u++){var v=i[u];4!==v.type&&(s=!1,r=r.put(47,!1,!1),n+="/",r=_[v.type](v,r),n+=x[v.type](v))}a[c]={handler:p.handler,names:f,shouldDecodes:d}}s&&(r=r.put(47,!1,!1),n+="/"),r.handlers=a,r.pattern=n+"$",r.types=o;var g;"object"==typeof e&&null!==e&&e.as&&(g=e.as),g&&(this.names[g]={segments:i,handlers:a})},j.prototype.handlersFor=function(t){var e=this.names[t];if(!e)throw new Error("There is no route named "+t);for(var r=new Array(e.handlers.length),n=0;n<e.handlers.length;n++){var o=e.handlers[n];r[n]=o}return r},j.prototype.hasRoute=function(t){return!!this.names[t]},j.prototype.generate=function(t,e){var r=this.names[t],n="";if(!r)throw new Error("There is no route named "+t);for(var o=r.segments,a=0;a<o.length;a++){var i=o[a];4!==i.type&&(n+="/",n+=D[i.type](i,e))}return"/"!==n.charAt(0)&&(n="/"+n),e&&e.queryParams&&(n+=this.generateQueryString(e.queryParams)),n},j.prototype.generateQueryString=function(t){var e=[],r=Object.keys(t);r.sort();for(var n=0;n<r.length;n++){var o=r[n],a=t[o];if(null!=a){var i=encodeURIComponent(o);if(A(a))for(var s=0;s<a.length;s++){var h=o+"[]="+encodeURIComponent(a[s]);e.push(h)}else i+="="+encodeURIComponent(a),e.push(i)}}return 0===e.length?"":"?"+e.join("&")},j.prototype.parseQueryString=function(t){for(var e=t.split("&"),r={},n=0;n<e.length;n++){var o=e[n].split("="),a=d(o[0]),i=a.length,s=!1,h=void 0;1===o.length?h="true":(i>2&&"[]"===a.slice(i-2)&&(s=!0,r[a=a.slice(0,i-2)]||(r[a]=[])),h=o[1]?d(o[1]):""),s?r[a].push(h):r[a]=h}return r},j.prototype.recognize=function(t){var e,r=[this.rootState],n={},a=!1,i=t.indexOf("#");-1!==i&&(t=t.substr(0,i));var s=t.indexOf("?");if(-1!==s){var h=t.substr(s+1,t.length);t=t.substr(0,s),n=this.parseQueryString(h)}"/"!==t.charAt(0)&&(t="/"+t);var u=t;j.ENCODE_AND_DECODE_PATH_SEGMENTS?t=o(t):(t=decodeURI(t),u=decodeURI(u));var c=t.length;c>1&&"/"===t.charAt(c-1)&&(t=t.substr(0,c-1),u=u.substr(0,u.length-1),a=!0);for(var d=0;d<t.length&&(r=l(r,t.charCodeAt(d))).length;d++);for(var v=[],g=0;g<r.length;g++)r[g].handlers&&v.push(r[g]);r=p(v);var y=v[0];return y&&y.handlers&&(a&&y.pattern&&"(.+)$"===y.pattern.slice(-5)&&(u+="/"),e=f(y,u,n)),e},j.VERSION="0.3.3",j.ENCODE_AND_DECODE_PATH_SEGMENTS=!0,j.Normalizer={normalizeSegment:a,normalizePath:o,encodePathSegment:i},j.prototype.map=m,j});