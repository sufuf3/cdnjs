"use strict";function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _defineProperty(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function _objectWithoutProperties(e,t){var r={};for(var i in e)t.indexOf(i)>=0||Object.prototype.hasOwnProperty.call(e,i)&&(r[i]=e[i]);return r}Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),_extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i])}return e},_react=require("react"),_react2=_interopRequireDefault(_react),_reactDom=require("react-dom"),_reactDom2=_interopRequireDefault(_reactDom),_classnames2=require("classnames"),_classnames3=_interopRequireDefault(_classnames2),_immutabilityHelper=require("immutability-helper"),_immutabilityHelper2=_interopRequireDefault(_immutabilityHelper),_reactCssThemr=require("react-css-themr"),_identifiers=require("../identifiers.js"),_events=require("../utils/events"),_events2=_interopRequireDefault(_events),_prefixer=require("../utils/prefixer"),_prefixer2=_interopRequireDefault(_prefixer),_utils=require("../utils/utils"),_utils2=_interopRequireDefault(_utils),defaults={centered:!1,className:"",multiple:!0,spread:2,theme:{}},rippleFactory=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=_extends({},defaults,e),r=t.centered,i=t.className,p=t.multiple,n=t.spread,a=t.theme,s=_objectWithoutProperties(t,["centered","className","multiple","spread","theme"]);return function(e){var t=function(t){function r(){var e,t,i,p;_classCallCheck(this,r);for(var n=arguments.length,a=Array(n),s=0;s<n;s++)a[s]=arguments[s];return t=i=_possibleConstructorReturn(this,(e=r.__proto__||Object.getPrototypeOf(r)).call.apply(e,[this].concat(a))),i.state={ripples:{}},i.handleMouseDown=function(e){if(i.props.onMouseDown&&i.props.onMouseDown(e),!i.props.disabled){var t=_events2.default.getMousePosition(e),r=t.x,p=t.y;i.animateRipple(r,p,!1)}},i.handleTouchStart=function(e){if(i.props.onTouchStart&&i.props.onTouchStart(e),!i.props.disabled){var t=_events2.default.getTouchPosition(e),r=t.x,p=t.y;i.animateRipple(r,p,!0)}},p=t,_possibleConstructorReturn(i,p)}return _inherits(r,t),_createClass(r,[{key:"componentDidUpdate",value:function(e,t){Object.keys(t.ripples).length<Object.keys(this.state.ripples).length&&this.addRippleRemoveEventListener(this.getLastKey())}},{key:"componentWillUnmount",value:function(){var e=this;Object.keys(this.state.ripples).forEach(function(t){e.state.ripples[t].endRipple()})}},{key:"addRippleRemoveEventListener",value:function(e){var t=this;_events2.default.addEventListenerOnTransitionEnded(this.refs[e],function r(i){"opacity"===i.propertyName&&(t.props.onRippleEnded&&t.props.onRippleEnded(i),_events2.default.removeEventListenerOnTransitionEnded(t.refs[e],r),t.setState({ripples:_utils2.default.removeObjectKey(e,t.state.ripples)}))})}},{key:"animateRipple",value:function(e,t,r){var i=this;this.rippleShouldTrigger(r)&&!function(){var p=i.getDescriptor(e,t),n=p.top,a=p.left,s=p.width,l=0===Object.keys(i.state.ripples).length,o=i.props.rippleMultiple||l?i.getNextKey():i.getLastKey(),u=i.addRippleDeactivateEventListener(r,o),c={active:!1,restarting:!0,top:n,left:a,width:s,endRipple:u},d={active:!0,restarting:!1};i.setState((0,_immutabilityHelper2.default)(i.state,{ripples:_defineProperty({},o,{$set:c})}),function(){i.refs[o].offsetWidth,i.setState((0,_immutabilityHelper2.default)(i.state,{ripples:_defineProperty({},o,{$merge:d})}))})}()}},{key:"rippleShouldTrigger",value:function(e){var t=!!e||!this.touchCache;return this.touchCache=e,t}},{key:"getDescriptor",value:function(e,t){var r=_reactDom2.default.findDOMNode(this).getBoundingClientRect(),i=r.left,p=r.top,n=r.height,a=r.width,s=this.props,l=s.rippleCentered,o=s.rippleSpread;return{left:l?0:e-i-a/2,top:l?0:t-p-n/2,width:a*o}}},{key:"getNextKey",value:function(){return this.currentCount=this.currentCount?this.currentCount+1:1,"ripple"+this.currentCount}},{key:"getLastKey",value:function(){return"ripple"+this.currentCount}},{key:"addRippleDeactivateEventListener",value:function(e,t){var r=e?"touchend":"mouseup",i=this.createRippleDeactivateCallback(r,t);return document.addEventListener(r,i),i}},{key:"createRippleDeactivateCallback",value:function(e,t){var r=this;return function i(){document.removeEventListener(e,i),r.setState({ripples:(0,_immutabilityHelper2.default)(r.state.ripples,_defineProperty({},t,{$merge:{active:!1}}))})}}},{key:"renderRipple",value:function(e,t,r){var i,p=r.active,n=r.left,a=r.restarting,l=r.top,o=r.width,u=a?0:1,c="translate3d("+(-o/2+n)+"px, "+(-o/2+l)+"px, 0) scale("+u+")",d=(0,_classnames3.default)(this.props.theme.ripple,(i={},_defineProperty(i,this.props.theme.rippleActive,p),_defineProperty(i,this.props.theme.rippleRestarting,a),i),t);return _react2.default.createElement("span",_extends({key:e,"data-react-toolbox":"ripple",className:this.props.theme.rippleWrapper},s),_react2.default.createElement("span",{role:"ripple",ref:e,className:d,style:(0,_prefixer2.default)({transform:c},{width:o,height:o})}))}},{key:"render",value:function(){var t=this,r=this.state.ripples,i=this.props,p=(i.onRippleEnded,i.rippleCentered,i.rippleMultiple,i.rippleSpread,i.children),n=i.ripple,a=i.rippleClassName,s=_objectWithoutProperties(i,["onRippleEnded","rippleCentered","rippleMultiple","rippleSpread","children","ripple","rippleClassName"]);return n?_react2.default.createElement(e,_extends({},s,{onMouseDown:this.handleMouseDown,onTouchStart:this.handleTouchStart}),p,Object.keys(r).map(function(e){return t.renderRipple(e,a,r[e])})):_react2.default.createElement(e,_extends({children:p},s))}}]),r}(_react.Component);return t.propTypes={children:_react.PropTypes.any,disabled:_react.PropTypes.bool,onRippleEnded:_react.PropTypes.func,ripple:_react.PropTypes.bool,rippleCentered:_react.PropTypes.bool,rippleClassName:_react.PropTypes.string,rippleMultiple:_react.PropTypes.bool,rippleSpread:_react.PropTypes.number,theme:_react.PropTypes.shape({ripple:_react.PropTypes.string,rippleActive:_react.PropTypes.string,rippleRestarting:_react.PropTypes.string,rippleWrapper:_react.PropTypes.string})},t.defaultProps={disabled:!1,ripple:!0,rippleCentered:r,rippleClassName:i,rippleMultiple:p,rippleSpread:n},(0,_reactCssThemr.themr)(_identifiers.RIPPLE,a)(t)}};exports.default=rippleFactory;
//# sourceMappingURL=Ripple.min.js.map